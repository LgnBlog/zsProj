(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-77898558"],{4790:function(e,t,r){},"61cb":function(e,t,r){"use strict";var n=r("ee56"),i=r.n(n);i.a},"833e":function(e,t,r){"use strict";var n=r("4790"),i=r.n(n);i.a},"921b":function(e,t,r){"use strict";r.r(t);var n=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{class:"1"===e.$root.themeHomeChange?"planEntry_light":"planEntry"},[r("div",{staticClass:"planEntry-con"},[r("div",{staticClass:"headBox"},[r("span",{staticClass:"title"},[e._v(" 计划执行 ")]),1===e.stepNum?r("bda-button",{on:{click:e.goBack}},[e._v("关闭")]):r("bda-button",{on:{click:function(t){e.stepNum--}}},[e._v("返回上一步")])],1),r("div",{staticClass:"content"},[r("div",{staticClass:"formList"},[r("el-form",{directives:[{name:"loading",rawName:"v-loading",value:e.formLoading,expression:"formLoading"}],key:e.stepNum,ref:"form",attrs:{model:e.form,rules:e.rules[e.stepNum],"label-width":"120px","label-suffix":"：","label-position":"left","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.8)"}},[r("el-row",{directives:[{name:"show",rawName:"v-show",value:1===e.stepNum,expression:"stepNum === 1"}],attrs:{gutter:30}},[r("el-col",{attrs:{span:5}},[r("bda-form-item",{attrs:{prop:"year"}},[r("el-date-picker",{staticStyle:{"margin-right":"15px"},attrs:{type:"year",placeholder:"请选择年度","value-format":"yyyy"},on:{change:function(t){return e.queryJdjhList(!0)}},model:{value:e.form.year,callback:function(t){e.$set(e.form,"year",t)},expression:"form.year"}})],1)],1),r("el-col",{attrs:{span:7}},[r("bda-form-item",{attrs:{prop:"supervisionType"}},[r("bda-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",clearable:"",placeholder:"请选择监督类型"},on:{change:function(t){return e.queryJdjhList(!0)}},model:{value:e.form.supervisionType,callback:function(t){e.$set(e.form,"supervisionType",t)},expression:"form.supervisionType"}},e._l(e.options["supervisionType"],(function(e,t){return r("bda-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1)],1),r("el-col",{attrs:{span:12}},[r("bda-form-item",{attrs:{prop:"jdjhId"}},[r("bda-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",clearable:"",disabled:!(e.form.year&&e.form.supervisionType),placeholder:e.form.year&&e.form.supervisionType?"请选择监督项目":"请先选择年度及监督项目类型"},on:{change:e.getJdnrByjdrw},model:{value:e.form.jdjhId,callback:function(t){e.$set(e.form,"jdjhId",t)},expression:"form.jdjhId"}},e._l(e.options["jdjhId"],(function(e,t){return r("bda-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1)],1),r("el-col",{staticStyle:{height:"100px"},attrs:{span:24}},[r("bda-form-item",{attrs:{label:"监督内容",prop:"jdnr"}},[r("el-input",{attrs:{resize:"none",type:"textarea",autosize:{minRows:3,maxRows:3},placeholder:"请选择监督项目",disabled:""},model:{value:e.form.jdnr,callback:function(t){e.$set(e.form,"jdnr",t)},expression:"form.jdnr"}})],1)],1),r("el-col",{staticStyle:{height:"auto!important"},attrs:{span:24}},[r("bda-form-item",{attrs:{label:"计划开展内容",prop:"jhkznr"}},[r("div",{staticClass:"swiperBox"},e._l(e.form.jhkznr,(function(t,n){return r("div",{key:n,staticClass:"itemBox"},[r("span",{staticClass:"input_box"},[r("el-input",{attrs:{resize:"none",type:"textarea",autosize:{minRows:1,maxRows:1},placeholder:"请输入内容 <"+(n+1)+">"},model:{value:e.form.jhkznr[n],callback:function(t){e.$set(e.form.jhkznr,n,t)},expression:"form.jhkznr[index]"}})],1),e.form.jhkznr.length===n+1?r("span",{staticClass:"btn_box"},[r("el-button",{attrs:{plain:"1"===e.$root.themeHomeChange},on:{click:function(t){return e.form.jhkznr.push("")}}},[e._v("增加")]),r("el-button",{attrs:{type:"danger",plain:"1"===e.$root.themeHomeChange,disabled:e.form.jhkznr.length<=1},on:{click:function(t){return e.form.jhkznr.pop()}}},[e._v("删除")])],1):e._e()])})),0)])],1),r("el-col",{staticStyle:{height:"auto!important"},attrs:{span:24}},[r("bda-form-item",{attrs:{label:"发现问题",prop:"question"}},[r("div",{staticClass:"swiperBox"},e._l(e.form.question,(function(t,n){return r("div",{key:n,staticClass:"itemBox"},[r("span",{staticClass:"input_box"},[r("el-input",{attrs:{resize:"none",type:"textarea",autosize:{minRows:1,maxRows:1},placeholder:"请输入内容 <"+(n+1)+">"},model:{value:e.form.question[n],callback:function(t){e.$set(e.form.question,n,t)},expression:"form.question[index]"}})],1),e.form.question.length===n+1?r("span",{staticClass:"btn_box"},[r("el-button",{attrs:{plain:"1"===e.$root.themeHomeChange},on:{click:function(t){return e.form.question.push("")}}},[e._v("增加")]),r("el-button",{attrs:{type:"danger",plain:"1"===e.$root.themeHomeChange,disabled:e.form.question.length<=1},on:{click:function(t){return e.form.question.pop()}}},[e._v("删除")])],1):e._e()])})),0)])],1),r("el-col",{attrs:{span:24}},[r("bda-form-item",{attrs:{label:"问题类别",prop:"questionType"}},[r("el-input",{attrs:{placeholder:"请输入问题类别",clearable:"",size:"small"},model:{value:e.form.questionType,callback:function(t){e.$set(e.form,"questionType",t)},expression:"form.questionType"}})],1)],1),r("el-col",{attrs:{span:12}},[r("bda-form-item",{attrs:{label:"责任单位",prop:"zrdw"}},[r("el-input",{attrs:{placeholder:"请输入责任单位",clearable:"",size:"small"},model:{value:e.form.zrdw,callback:function(t){e.$set(e.form,"zrdw",t)},expression:"form.zrdw"}})],1)],1),r("el-col",{attrs:{span:12}},[r("bda-form-item",{attrs:{label:"责任人",prop:"zrr"}},[r("el-input",{attrs:{placeholder:"请输入责任人",clearable:"",size:"small"},model:{value:e.form.zrr,callback:function(t){e.$set(e.form,"zrr",t)},expression:"form.zrr"}})],1)],1),r("el-col",{staticStyle:{height:"100px"},attrs:{span:24}},[r("bda-form-item",{attrs:{label:"整改措施",prop:"zgcs"}},[r("el-input",{attrs:{resize:"none",type:"textarea",autosize:{minRows:3,maxRows:3},placeholder:"请输入整改措施"},model:{value:e.form.zgcs,callback:function(t){e.$set(e.form,"zgcs",t)},expression:"form.zgcs"}})],1)],1)],1),r("el-row",{directives:[{name:"show",rawName:"v-show",value:2===e.stepNum,expression:"stepNum === 2"}],attrs:{gutter:30}},[r("el-col",{staticStyle:{height:"auto"},attrs:{span:24}},[r("bda-form-item",{attrs:{label:"计划整改情况",prop:"jhzgqk"}},[r("el-input",{attrs:{resize:"none",type:"textarea",autosize:{minRows:1,maxRows:3},placeholder:"请输入计划整改情况"},model:{value:e.form.jhzgqk,callback:function(t){e.$set(e.form,"jhzgqk",t)},expression:"form.jhzgqk"}})],1)],1),r("el-col",{staticStyle:{height:"auto"},attrs:{span:24}},[r("bda-form-item",{staticClass:"formItem-right",attrs:{label:"上传附件: ","label-width":"200px",prop:"filePath"}},[r("el-upload",{ref:"uploadObj",staticStyle:{display:"flex","flex-wrap":"wrap"},attrs:{action:e.fileUrl+e.form.jdjhId,"list-type":"picture-card","on-success":e.handleSuccess,"on-error":e.handleError,"file-list":e.form.fileList,"auto-upload":!0,accept:".xls, .xlsx, .docx, .pdf","before-upload":e.beforeUpload,limit:1,"on-exceed":e.handleExceed},scopedSlots:e._u([{key:"file",fn:function(t){var n=t.file;return r("div",{},[r("div",{staticClass:"fileClass"},[r("i",{staticClass:"el-icon-document"},[r("el-tooltip",{staticClass:"btn-trip",attrs:{effect:"dark",content:n.name,placement:"bottom"}},[r("span",[r("p",[e._v(e._s(n.name))])])])],1),r("el-popconfirm",{attrs:{"popper-class":"1"===e.$root.themeHomeChange?"popconfirmClass_light":"popconfirmClass","confirm-button-text":"确定","cancel-button-text":"取消",icon:"el-icon-info","icon-color":"red",title:"是否删除 "+n.name+" ？"},on:{confirm:function(t){return e.deleteUploadItem(n)}}},[r("i",{staticClass:"deleteIcon el-icon-circle-close",attrs:{slot:"reference"},slot:"reference"})])],1)])}}])},[r("i",{staticClass:"el-icon-plus",attrs:{slot:"default"},slot:"default"},[r("p",[e._v("上传附件")])])]),r("p",{staticStyle:{color:"#bbb","font-size":"10px"}},[e._v("文件后缀名可为xls 或xlsx （即Excel格式）、word、pdf等，文件大小不得大于30M。")])],1)],1),r("el-col",{attrs:{span:12}},[r("bda-form-item",{staticStyle:{padding:"0 15px"},attrs:{label:"是否完成整改",prop:"isCompletedRectify"}},[r("el-radio-group",{on:{change:function(){e.form.unfinishedRectifyReason=""}},model:{value:e.form.isCompletedRectify,callback:function(t){e.$set(e.form,"isCompletedRectify",t)},expression:"form.isCompletedRectify"}},[r("el-radio",{attrs:{label:1}},[e._v("是")]),r("el-radio",{attrs:{label:0}},[e._v("否")])],1)],1)],1),0===e.form.isCompletedRectify?r("el-col",{staticStyle:{height:"auto"},attrs:{span:24}},[r("bda-form-item",{attrs:{label:"未完成整改原因说明",prop:"unfinishedRectifyReason"}},[r("el-input",{attrs:{resize:"none",type:"textarea",autosize:{minRows:1,maxRows:3},placeholder:"请输入未完成整改原因说明"},model:{value:e.form.unfinishedRectifyReason,callback:function(t){e.$set(e.form,"unfinishedRectifyReason",t)},expression:"form.unfinishedRectifyReason"}})],1)],1):e._e(),r("el-col",{attrs:{span:12}},[r("bda-form-item",{attrs:{label:"整改完成时间",prop:"completedRectifyDate"}},[r("el-input-number",{staticStyle:{width:"100%"},attrs:{min:1,max:12,size:"mini",placeholder:"请输入整改完成时间(月份)"},model:{value:e.form.completedRectifyDate,callback:function(t){e.$set(e.form,"completedRectifyDate",t)},expression:"form.completedRectifyDate"}})],1)],1)],1)],1)],1),r("div",{staticClass:"submit"},[1===e.stepNum?r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.nextStep()}}},[e._v(" 下一步 ")]):r("span",[r("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v(" 提交 ")]),r("el-button",{on:{click:function(t){return e.goBack()}}},[e._v(" 取消 ")])],1)],1)])])])},i=[],o=(r("8e6e"),r("ac6a"),r("456d"),r("6762"),r("7f7f"),r("7514"),r("6b54"),r("ade3")),a=r("1a48"),s=r("c1df"),l=r.n(s),c=r("db49");function u(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function f(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?u(r,!0).forEach((function(t){Object(o["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):u(r).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var m={components:{},mixins:[a["a"]],props:{formData_in:{type:Object,default:function(){return{}}}},data:function(){var e=function(e,t,r){return 0!==t.length?t.some((function(e){return""==e.trim()}))?r(new Error("请填写完整计划开展内容")):r():r(new Error("数据出现错误，请出现打开"))},t=function(e,t,r){return 0!==t.length?t.some((function(e){return""==e.trim()}))?r(new Error("请填写完整发现问题内容")):r():r(new Error("数据出现错误，请出现打开"))};return{formLoading:!1,fileUrl:c["b"]+"/supervision/exec/file/upload?jdrwId=",stepNum:1,form:{jhkznr:[""],question:[""],questionType:"",year:"",jdjhId:"",jdnr:"",unfinishedRectifyReason:"",fileList:[]},detailInfo:[],keyValue:"",chartData:{},infoLoading:!1,infoData:{},options:{supervisionType:[{label:"职能监督",value:"职能监督"},{label:"专业监督",value:"专业监督"},{label:"专责监督",value:"专责监督"},{label:"安全监督",value:"安全监督"},{label:"基层单位日常监督",value:"基层单位日常监督"}],questionType:[{label:"职能监督",value:"职能监督"},{label:"专业监督",value:"专业监督"},{label:"专责监督",value:"专责监督"},{label:"安全监督",value:"安全监督"},{label:"基层单位日常监督",value:"基层单位日常监督"}],jdjhId:[]},rules:{1:{jhkznr:[{required:!0,validator:e,trigger:"blur"}],question:[{required:!0,validator:t,trigger:"blur"}],questionType:[{required:!0,message:"请输入问题类别",trigger:"blur"}],zgcs:[{required:!0,message:"请输入整改措施",trigger:"blur"}],jdjhId:[{required:!0,message:"请选择监督项目",trigger:"change"}]},2:{jhzgqk:[{required:!0,message:"请输入计划整改情况",trigger:"blur"}],filePath:[{required:!0,message:"请上传附件",trigger:"change"}],isCompletedRectify:[{required:!0,message:"请选择是否完成整改",trigger:"change"}],completedRectifyDate:[{required:!0,message:"请输入整改完成时间（月份）",trigger:"change"}],unfinishedRectifyReason:[{required:!0,message:"请输入未完成整改原因说明",trigger:"blur"}]}}}},created:function(){},mounted:function(){},watch:{"form.isCompletedRectify":{handler:function(e){2===this.stepNum&&(this.rules[this.stepNum]["unfinishedRectifyReason"][0].required=1!==e)},immediate:!1,deep:!0},"form.fileList":{handler:function(e){this.form.filePath=Array.isArray(e)&&0!==e.length?e[0].url:""},deep:!0},formData_in:{handler:function(e){var t=this;if(e&&e.jdjhId&&e.jdrwId){var r="",n="";this.getSupervisionDetails({id:e.jdjhId}).then((function(e){e&&e.id&&(n=e.nd,r=e.type)})).finally((function(){})),setTimeout((function(){t.form=JSON.parse(JSON.stringify(f({},e,{year:n,supervisionType:r,fileList:[{name:t.getFileName(e.filePath),url:e.filePath}],jhkznr:Array.isArray(e.jhkznrList)&&0!==e.jhkznrList.length?e.jhkznrList.map((function(e){return e.jhkznr})):[""],question:Array.isArray(e.questionList)&&0!==e.questionList.length?e.questionList.map((function(e){return e.question})):[""]}))),t.queryJdjhList(!1)}),500)}else this.form={jhkznr:[""],question:[""],questionType:"",year:(new Date).getFullYear().toString(),jdjhId:"",jdnr:"",unfinishedRectifyReason:"",fileList:[]}},immediate:!0,deep:!0}},methods:{nextStep:function(){var e=this;this.$refs["form"].validate((function(t){if(!t)return!1;e.stepNum++,window.console.log(e.stepNum,e.form)}))},formatDate:function(e,t){return e?l()(e).format(t):" / "},deleteUploadItem:function(e){var t=this.$refs["uploadObj"].uploadFiles;t.splice(t.indexOf(e),1),this.form.fileList.splice(this.form.fileList.indexOf(e),1)},queryJdjhList:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r={type:this.form.supervisionType,year:this.form.year,usepage:!1};this.getSupervisionList(r).then((function(t){e.options["jdjhId"]=t?t.rows.map((function(e){return{label:e.jdxmmc,value:e.id,jdnr:e.jdnr}})):[]})).finally((function(){t&&(e.form.jdjhId="",e.form.jdnr="")}))},getJdnrByjdrw:function(e){var t=this.options["jdjhId"].find((function(t){return t.value===e}));this.form.jdnr=t&&t.jdnr},getFileName:function(e){var t=e.lastIndexOf("/"),r=e.lastIndexOf("\\"),n=Math.max(t,r);return n<0?e:e.substring(n+1)},submit:function(){var e=this;this.$refs["form"].validate((function(t){if(!t)return!1;e.$confirm("此操作将执行当前设置的监督计划, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){e.formLoading=!0,e[e.form.jdrwId?"supervisionExecUpdate":"supervisionExecAdd"](e.form).then((function(){e.$message.success("提交成功"),e.goBack()})).finally((function(){e.formLoading=!1}))})).catch((function(){}))}))},beforeUpload:function(e){window.console.log(e,"上传校验");var t=e.name.substring(e.name.lastIndexOf(".")+1),r=["xls","xlsx","docx","pdf"],n=e.size/1024/1024<30;return r.includes(t)||this.$message({message:"上传文件只能是 xls、xlsx、docx、pdf格式!",type:"warning"}),n||this.$message({message:"上传文件大小不能超过 30MB!",type:"warning"}),r.includes(t)&&n},handleRemove:function(e,t){window.console.log(e,t)},handlePreview:function(e){window.console.log(e)},handleError:function(){this.$message.error("附件上传失败 !")},handleExceed:function(){this.$message.warning("附件上传超出限制个数 !")},handleSuccess:function(e,t){Array.isArray(this.form.fileList)&&0!==this.form.fileList.length?this.form.fileList.push({name:this.getFileName(t.response.data),url:t.response.data}):(this.form.fileList=[],this.form.fileList.push({name:this.getFileName(t.response.data),url:t.response.data})),this.$message.success("".concat(t.name," 上传成功！"))},goBack:function(){this.$emit("closeDilag")}}},p=m,d=(r("833e"),r("61cb"),r("2877")),h=Object(d["a"])(p,n,i,!1,null,"de8f0f44",null);t["default"]=h.exports},ee56:function(e,t,r){}}]);
//# sourceMappingURL=chunk-77898558.769df682.js.map