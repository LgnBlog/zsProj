(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-3eff898f","chunk-6f996d08"],{"0053":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("bda-dialog",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],class:"1"===e.$root.themeHomeChange?"addDialog_light":"addDialog",attrs:{visible:e.dialogVisible,modal:!1,"close-on-click-modal":!1,title:"新建合规任务","element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading","element-loading-background":"rgba(0, 0, 0, 0.3)"},on:{close:e.closeDialog,cancel:e.closeDialog}},[a("div",{staticClass:"dialogBox"},[a("el-form",{ref:"form",attrs:{model:e.formData,rules:e.rules,"label-width":"110px","label-suffix":"：",label:"任务基础信息"}},[[a("p",{staticClass:"tableTitle"},[e._v("任务基础信息")])],a("el-row",[a("el-col",{attrs:{span:8}},[a("bda-form-item",{attrs:{label:"任务名称",prop:"taskName"}},[a("bda-input",{attrs:{clearable:"",placeholder:"请输入"},model:{value:e.formData.taskName,callback:function(t){e.$set(e.formData,"taskName",t)},expression:"formData.taskName"}})],1)],1),a("el-col",{attrs:{span:8}},[a("bda-form-item",{attrs:{label:"任务类别",prop:"taskType"}},[a("bda-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.formData.taskType,callback:function(t){e.$set(e.formData,"taskType",t)},expression:"formData.taskType"}},e._l(e.form.type,(function(e){return a("bda-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),a("el-col",{attrs:{span:8}},[a("bda-form-item",{attrs:{label:"业务流程",prop:"processId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",clearable:"",placeholder:"请选择"},on:{change:e.processChange},model:{value:e.formData.processId,callback:function(t){e.$set(e.formData,"processId",t)},expression:"formData.processId"}},e._l(e.form.process,(function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:8}},[a("bda-form-item",{attrs:{label:"选择项目",prop:"projectCode"}},[a("bda-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.formData.projectCode,callback:function(t){e.$set(e.formData,"projectCode",t)},expression:"formData.projectCode"}},e._l(e.form.projectList,(function(e){return a("bda-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),a("el-col",{attrs:{span:8}},[a("bda-form-item",{attrs:{label:"检查单位",prop:"checkUnit"}},[a("bda-input",{attrs:{clearable:"",placeholder:"请输入"},model:{value:e.formData.checkUnit,callback:function(t){e.$set(e.formData,"checkUnit",t)},expression:"formData.checkUnit"}})],1)],1),a("el-col",{attrs:{span:8}},[a("bda-form-item",{attrs:{label:"被检单位",prop:"beCheckUnitIds"}},[a("SelectTree",{ref:"selectTreeRef",staticStyle:{width:"100%"},attrs:{props:e.defaultProps,options:e.treeData,value:e.valueId,clearable:e.isClearable,accordion:e.isAccordion},on:{getValue:function(t){return e.getValue(t)}}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:8}},[a("bda-form-item",{attrs:{label:"检查时间段",prop:"checkDate"}},[a("bda-date-picker",{attrs:{clearable:!1,"range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetimerange"},model:{value:e.formData.checkDate,callback:function(t){e.$set(e.formData,"checkDate",t)},expression:"formData.checkDate"}})],1)],1),a("el-col",{attrs:{span:8}},[a("bda-form-item",{attrs:{label:"定时任务开始时间",prop:"timingTaskStartDate"}},[a("bda-date-picker",{attrs:{clearable:!1,placeholder:"请选择日期时间","value-format":"yyyy-MM-dd HH:mm:ss",type:"datetime"},model:{value:e.formData.timingTaskStartDate,callback:function(t){e.$set(e.formData,"timingTaskStartDate",t)},expression:"formData.timingTaskStartDate"}})],1)],1),a("el-col",{attrs:{span:8}},[a("bda-form-item",{attrs:{label:"执行周期",prop:"taskPerformSync"}},[a("bda-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.formData.taskPerformSync,callback:function(t){e.$set(e.formData,"taskPerformSync",t)},expression:"formData.taskPerformSync"}},e._l(e.form.taskPerformSync,(function(e){return a("bda-option",{key:e.id,attrs:{label:e.name,value:e.value}})})),1)],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:24}},[a("bda-form-item",{attrs:{label:"任务简介",prop:"taskDesc"}},[a("bda-input",{attrs:{type:"textarea",resize:"none",clearable:"",placeholder:"请输入"},model:{value:e.formData.taskDesc,callback:function(t){e.$set(e.formData,"taskDesc",t)},expression:"formData.taskDesc"}})],1)],1)],1),[a("p",{staticClass:"tableTitle"},[e._v("检验规则")])],a("el-row",[a("el-col",{attrs:{span:22}},[a("bda-form-item",{attrs:{prop:"taskRules"}},[a("bda-select",{staticStyle:{width:"260px"},attrs:{size:"small",filterable:"",clearable:"",placeholder:"请选择"},model:{value:e.formData.taskRules,callback:function(t){e.$set(e.formData,"taskRules",t)},expression:"formData.taskRules"}},e._l(e.form.taskRules,(function(e){return a("bda-option",{key:e.id,attrs:{label:e.name,value:e.id}})})),1)],1)],1),a("el-col",{attrs:{span:2,fixed:"right"}},[a("el-button",{staticStyle:{float:"right"},attrs:{type:"info"},on:{click:e.clearTaskRulesList}},[e._v("清空")])],1)],1),a("div",{staticClass:"taskRulesArea"},e._l(e.formData.ruleIds,(function(t){return a("el-tag",{key:t.id,attrs:{closable:""},on:{close:function(a){return e.closeTag(t.id)}}},[e._v("\n          "+e._s(t.name)+"\n        ")])})),1)],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("bda-button",{attrs:{bdatype:"primary"},on:{click:e.sureDialog}},[e._v("保存")]),a("el-button",{attrs:{type:"info"},on:{click:e.closeDialog}},[e._v("关闭")])],1)])},l=[],i=(a("456d"),a("ac6a"),a("7f7f"),a("7514"),a("1a48")),n=a("8986"),s=a("dd2a"),o=a("2a17"),c={mixins:[i["a"],n["a"],s["a"]],components:{SelectTree:o["default"]},data:function(){return{dialogVisible:!1,form:{checkDate:"",type:[{id:"1",name:"实时性检查"},{id:"2",name:"计划性检查"},{id:"3",name:"专项性检查"}],process:[],projectList:[],taskPerformSync:[{id:0,value:"仅一次",name:"仅一次"},{id:1,value:"每天",name:"每天"},{id:2,value:"每三天",name:"每三天"},{id:3,value:"每一周",name:"每一周"},{id:4,value:"每半个月",name:"每半个月"},{id:5,value:"每一个月",name:"每一个月"},{id:6,value:"每三个月",name:"每三个月"},{id:7,value:"每半年",name:"每半年"},{id:8,value:"每一年",name:"每一年"}],taskRules:[]},rules:{taskName:[{required:!0,message:"请填写文档名称",trigger:"blur"}],taskType:[{required:!0,message:"请选择任务类别",trigger:"blur"}],checkUnit:[{required:!0,message:"请填写检查单位",trigger:"blur"}],checkDate:[{required:!0,message:"请选择检查时间段",trigger:"blur"}],beCheckUnitIds:[{required:!0,message:"请选择被检单位",trigger:"blur"}]},formData:{taskName:"",taskType:"",project:"",projectCode:"",checkUnit:"XX检查单位",checkDate:"",checkStartDate:"",checkEndDate:"",beCheckUnitIds:"",timingTaskStartDate:"",taskDesc:"",taskRules:"",ruleIds:[]},loading:!1,valueId:[],isClearable:!0,isAccordion:!0,treeData:[],defaultProps:{children:"list",label:"orgName",value:"orgId"}}},watch:{"formData.taskRules":function(e){if(window.console.log("****",e,this.formData.ruleIds),""!=e){var t=this.form.taskRules.find((function(t){return t.id===e}));if(0===this.formData.ruleIds.length){var a={id:t.id,name:t.name};this.formData.ruleIds.push(a)}else{if(this.formData.ruleIds.some((function(t){return e===t.id})))return;var r={id:t.id,name:t.name};this.formData.ruleIds.push(r)}}},"formData.checkDate":{handler:function(e){e?(this.formData.checkStartDate=e[0],this.formData.checkEndDate=e[1]):(this.formData.checkStartDate="",this.formData.checkEndDate="")},deep:!0},"formData.projectCode":{handler:function(e){if(e){var t=this.form.projectList.find((function(t){return t.id===e}));this.formData.project=t&&t.name||""}else this.formData.project=""},deep:!0}},computed:{optionData:function(){var e=JSON.parse(JSON.stringify(this.treeData));return e.filter((function(t){var a=e.filter((function(e){return t.id==e.id}));return a.length>0&&(t.children=a),0==t.id}))}},mounted:function(){},methods:{getOrgData:function(){var e=this;this.getOrgTreeData().then((function(t){Array.isArray(t)&&0!==t.length?e.treeData=t:e.treeData=[]})).finally((function(){}))},getProject_list:function(){var e=this;this.getProjectList().then((function(t){Array.isArray(t)&&0!==t.length?e.form.projectList=t.map((function(e){return{id:e,name:e}})):e.form.projectList=[]})).finally((function(){}))},openDialog:function(){this.initForm(),this.processChange(""),this.dialogVisible=!0,this.formData={taskName:"",taskType:"",project:"",projectCode:"",checkUnit:"XX检查单位",checkDate:"",checkStartDate:"",checkEndDate:"",beCheckUnitIds:"",timingTaskStartDate:"",taskDesc:"",taskRules:"",ruleIds:[]}},closeDialog:function(){this.dialogVisible=!1,this.loading=!1,this.$refs["form"].resetFields(),this.valueId=[],this.$refs.selectTreeRef.clearHandle(),this.$emit("closeDialog")},sureDialog:function(){var e=this;this.$refs.form.validate((function(t){t&&e.$emit("addTableData",JSON.parse(JSON.stringify(e.formData)))}))},processChange:function(e){var t=this,a=this.form.process.find((function(t){return t.id==e}));this.formData.businessProcessId=a&&a.pId||"",this.getTaskProcess({ywlcId:e}).then((function(e){window.console.log(e),Array.isArray(e)&&0!==e.length?t.form.taskRules=e.map((function(e){return{id:e.code,name:e.name}})):t.form.taskRules=[]})).finally((function(){t.formData.taskRules="",t.clearTaskRulesList()}))},initForm:function(){var e=this;this.getOrgData(),this.getProject_list(),this.getProcessList({usePage:!1}).then((function(t){e.form.process=t?t.map((function(e){return{id:e.ywlcId,pId:e.id,name:e.ywlcName}})):[]})).finally((function(){}))},addTableData:function(){this.$emit("addTableData",this.formData)},editForm:function(e){var t=this;this.initForm(),this.dialogVisible=!0,this.formData.checkDate=[e.checkStartDate,e.checkEndDate],Object.keys(e).forEach((function(a){t.formData[a]=e[a]})),e.processId&&this.processChange(e.processId),e.id&&this.getRuleListById(e.id),e.id&&this.getBeCheckUnitByTaskId(e.id)},getBeCheckUnitByTaskId:function(e){var t=this;this.getBeCheckUnitById({taskId:e}).then((function(e){Array.isArray(e)&&0!==e.length?(t.valueId=e,t.getValue(e)):t.valueId=[]})).finally((function(){}))},getRuleListById:function(e){var t=this;this.getRuleTableListByTaskId({taskId:e}).then((function(e){Array.isArray(e)&&0!==e.length?t.formData.ruleIds=e.map((function(e){return{id:e.ruleId,name:e.ruleName}})):t.formData.ruleIds=[]})).finally((function(){}))},closeTag:function(e){this.formData.ruleIds=this.formData.ruleIds.filter((function(t){return t.id!==e}))},clearTaskRulesList:function(){this.formData.ruleIds=[]},getValue:function(e){var t=this;Array.isArray(e)&&0!==e.length?this.formData.beCheckUnitIds=e.map((function(e){return e[t.defaultProps.value]})).join(","):this.formData.beCheckUnitIds=""}}},u=c,d=(a("830c"),a("2877")),f=Object(d["a"])(u,r,l,!1,null,"09312c2a",null);t["default"]=f.exports},2909:function(e,t,a){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}function l(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}function i(){throw new TypeError("Invalid attempt to spread non-iterable instance")}function n(e){return r(e)||l(e)||i()}a.d(t,"a",(function(){return n}))},"2a17":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-select",{attrs:{value:e.valueTitle,clearable:e.clearable},on:{clear:e.clearHandle}},[a("el-option",{staticClass:"options",attrs:{value:e.valueTitle,label:e.valueTitle}},[a("el-tree",{ref:"selectTree",attrs:{id:"tree-option",accordion:e.accordion,data:e.options,props:e.props,"node-key":e.props.value,"default-expanded-keys":e.defaultExpandedKey,"filter-node-method":e.filterNode},on:{"node-click":e.handleNodeClick}})],1)],1)},l=[],i=(a("7f7f"),a("2909")),n=(a("ac6a"),{name:"el-tree-select",props:{props:{type:Object,default:function(){return{value:"id",label:"title",children:"children"}}},options:{type:Array,default:function(){return[]}},value:{type:Array,default:function(){return[]}},clearable:{type:Boolean,default:function(){return!0}},accordion:{type:Boolean,default:function(){return!1}}},data:function(){return{filterText:"",valueId:"",valueTitle:"",defaultExpandedKey:[],selectData:[]}},mounted:function(){this.initHandle()},methods:{initHandle:function(){var e=this;Array.isArray(this.value)&&0!==this.value.length&&(this.value.forEach((function(t){e.valueTitle+="".concat(t[e.props.label],"，")})),this.selectData=JSON.parse(JSON.stringify(this.value)),this.defaultExpandedKey=Object(i["a"])(this.value.map((function(t){return t[e.props.value]})))),this.initScroll()},initScroll:function(){this.$nextTick((function(){var e=document.querySelectorAll(".el-scrollbar .el-select-dropdown__wrap")[0],t=document.querySelectorAll(".el-scrollbar .el-scrollbar__bar");e.style.cssText="margin: 0px; max-height: none; overflow: hidden;",t.forEach((function(e){return e.style.width=0}))}))},handleNodeClick:function(e){var t=this;if(!Array.isArray(e[this.props.children])||0===e[this.props.children].length){var a="";this.selectData.some((function(a){return a[t.props.value]==e[t.props.value]}))||(this.selectData.push(e),this.selectData.forEach((function(e){return a+="".concat(e[t.props.label],"，")})),this.valueTitle=a,this.valueId=e[this.props.value],this.$emit("getValue",this.selectData),this.defaultExpandedKey=[])}},clearHandle:function(){this.valueTitle="",this.valueId="",this.defaultExpandedKey=[],this.selectData=[],this.clearSelected(),this.$emit("getValue",null)},clearSelected:function(){var e=document.querySelectorAll("#tree-option .el-tree-node");e.forEach((function(e){return e.classList.remove("is-current")}))},filterNode:function(e,t){return!e||-1!==t.name.indexOf(e)}},watch:{value:function(){this.initHandle()},filterText:function(e){this.$refs.selectTree.filter(e)}}}),s=n,o=(a("a113"),a("2877")),c=Object(o["a"])(s,r,l,!1,null,"732a1924",null);t["default"]=c.exports},"830c":function(e,t,a){"use strict";var r=a("f304"),l=a.n(r);l.a},a113:function(e,t,a){"use strict";var r=a("f7e1"),l=a.n(r);l.a},dd2a:function(e,t,a){"use strict";var r=a("db49"),l=a("ab3e"),i=r["b"]+"/organization/tree";function n(e){return Object(l["a"])({method:"GET",headers:{"Content-Type":"application/x-www-form-urlencoded"},data:e,url:i})}t["a"]={data:function(){return{common:{list:[],page:null,limit:null,total:0,model:null}}},methods:{getOrgTreeData:function(e){return n(e).then((function(e){return e}))}}}},f304:function(e,t,a){},f7e1:function(e,t,a){}}]);
//# sourceMappingURL=chunk-3eff898f.4f035dbe.js.map